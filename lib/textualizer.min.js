(function(b,j){function A(a){var b,c,g,h={};if(j.getComputedStyle)if(a=j.getComputedStyle(a,null),a.length){c=0;for(g=a.length;c<g;c++)b=a[c].replace(/\-([a-z])/,function(a,b){return b.toUpperCase()}),h[b]=a.getPropertyValue(a[c])}else for(b in a)"function"!==typeof a[b]&&"length"!==b&&(h[b]=a[b]);else for(b in a=a.currentStyle||a.style,a)Object.prototype.hasOwnProperty.call(a,b)&&(h[b]=a[b]);return h}function C(){this.pos=this.domNode=this.character=null;this.visited=this.inserted=this.used=!1}function v(){this.str=
"";this.characterList=[]}var l,D=1E3,E=500,F=2E3,G=2E3;v.prototype={use:function(a){var e=null;b.each(this.characterList,function(){if(this.character===a&&!this.used)return this.used=!0,e=this,!1});return e},reset:function(){b.each(this.characterList,function(){this.used=this.inserted=!1})}};l=function(a,e,c){var g;function h(a,m){var d=c.centered?(w-k.height())/2:0;b.each(m,function(b,f){f.pos=f.domNode.position();f.domNode=f.domNode.clone();f.pos.top+=d;f.domNode.css({left:f.pos.left,top:f.pos.top,
position:"absolute"});a.characterList.push(f)});k.html("")}function B(a){var m=[],d=new v,c,f,e;d.str=n[a];o.push(d);a=0;for(e=d.str.length;a<e;a++)c=d.str.charAt(a),""===c?k.append(" "):(f=new C,f.character=c,f.domNode=b("<span/>").text(c),k.append(f.domNode),m.push(f));h(d,m);return d}function l(){var a,c;c=[function(d){a=b.Deferred();d.animate({top:g,opacity:"hide"},a.resolve);return a.promise()},function(d){a=b.Deferred();d.fadeOut(1E3,a.resolve);return a.promise()}];return c[Math.floor(Math.random()*
c.length)]}function H(a,c){var d=[],e=[],f=b.Deferred(),g=l(),p;b.each(a.characterList,function(a,f){(p=c.use(f.character))?(p.domNode=f.domNode,p.inserted=!0,d.push(p)):function(a){e.push(a);g(f.domNode.delay(Math.random()*G)).done(function(){f.domNode.remove();a.resolve()})}(b.Deferred())});b.when.apply(null,e).done(function(){return f.resolve(d)});return f.promise()}function x(a){var e=b.fn.textualizer.effects,d="random"===c.effect?e[Math.floor(Math.random()*(e.length-2))+1][1]:y,g=b.Deferred(),
f=[];b.each(a.characterList,function(a,c){c.inserted||(c.domNode.css({left:c.pos.left,top:c.pos.top}),function(a){j.setTimeout(function(){d({item:c,container:q,dfd:a})},Math.random()*F);f.push(a)}(b.Deferred()))});b.when.apply(null,f).done(function(){g.resolve()});return g.promise()}function I(a,e){var d=b.Deferred(),g=[];j.setTimeout(function(){b.each(a,function(a,d){var e=b.Deferred();d.domNode.animate({left:d.pos.left,top:d.pos.top},c.rearrangeDuration,e.resolve);g.push(e.promise())});b.when.apply(null,
g).done(function(){j.setTimeout(function(){x(e).done(function(){d.resolve()})},E)})},D);return d.promise()}function J(){i===n.length-1&&(b.each(o,function(a,b){b.reset()}),i=-1,c.loop||K.pause());i++;z(i)}function L(a){var c=b.Deferred(),d=o[a];d||(d=B(a));r?H(r,d).done(function(a){I(a,d).done(function(){c.resolve()})}):x(d).done(function(){c.resolve()});r=d;return c.promise()}function z(b){u||L(b).done(function(){a.trigger("textualzer.blurbchanged",{index:b});j.setTimeout(J,c.duration)})}var K=this,
n=[],o,i,r,y=null,s=!1,u=!1,w,t,q,k;"random"!==c.effect&&b.each(b.fn.textualizer.effects,function(){if(this[0]===c.effect)return y=this[1],!1});t=a.clone().removeAttr("id").appendTo(j.document.body);t.css(A(a[0]));t.css({position:"absolute",top:"-1000px"});k=b("<div />").css({position:"relative",visibility:"hidden"}).appendTo(t);a.css("overflow","hidden");q=b("<div />").css("position","relative").appendTo(a);g=w=a.height();this.data=function(a){this.stop();n=a;o=[]};this.stop=function(){this.pause();
s=!1;r=null;i=0;q.empty();k.empty()};this.pause=function(){u=!0;s=!1};this.start=function(){0===n.length||s||(i=i||0,s=!0,u=!1,z(i))};this.destroy=function(){q.parent().removeData("textualizer").end().remove();k.remove()};e&&e instanceof Array&&this.data(e)};b.fn.textualizer=function(){var a=arguments,e,c,g,h;h=function(h){g=h.data("textualizer");g||(e=[],1===a.length&&a[0]instanceof Array?e=a[0]:1===a.length&&"object"===typeof a[0]?c=a[0]:2===a.length&&(e=a[0],c=a[1]),0===e.length&&h.find("p").each(function(){e.push(b(this).text())}),
h.html(""),g=new l(h,e,b.extend({},b.fn.textualizer.defaults,c)),h.data("textualizer",g));return g}(this);"string"===typeof a[0]&&h[a[0]]&&h[a[0]].apply(h,Array.prototype.slice.call(a,1));return this};b.fn.textualizer.defaults={effect:"random",duration:2E3,rearrangeDuration:1E3,centered:!1,loop:!0};b.fn.textualizer.effects=[["none",function(a){a.container.append(a.item.domNode.show())}],["fadeIn",function(a){a.container.append(a.item.domNode.fadeIn(2E3,a.dfd.resolve));return a.dfd.promise()}],["slideLeft",
function(a){a.item.domNode.appendTo(a.container).css({left:-1E3}).show().animate({left:a.item.pos.left},2E3,a.dfd.resolve);return a.dfd.promise()}],["slideTop",function(a){a.item.domNode.appendTo(a.container).css({top:-1E3}).show().animate({top:a.item.pos.top},2E3,a.dfd.resolve);return a.dfd.promise()}]]})(jQuery,window);